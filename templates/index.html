<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Physics Topic RSS Aggregator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; background: #f9f9f9; }
    h1 { margin-bottom: 1rem; color: #222; }
    .topic-section { margin-bottom: 3rem; background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .topic-title { font-size: 1.5rem; margin-bottom: 1rem; color: #333; border-bottom: 2px solid #0066cc; padding-bottom: 0.5rem; }
    .item { border-bottom: 1px solid #e5e5e5; padding: 1rem 0; }
    .item:last-child { border-bottom: none; }
    .item-title { font-size: 1.1rem; margin-bottom: 0.3rem; }
    .item-title a { color: #0066cc; text-decoration: none; }
    .item-title a:hover { text-decoration: underline; }
    .meta { color: #666; font-size: 0.9rem; margin-bottom: 0.3rem; }
    .source { color: #555; font-size: 0.85rem; margin-bottom: 0.5rem; }
    .summary { color: #444; font-size: 0.95rem; line-height: 1.5; }
    .count { color: #888; font-size: 0.9rem; margin-bottom: 1rem; }
    .loading { text-align: center; padding: 2rem; color: #666; }
  </style>
</head>
<body>
  <h1>Physics Topic RSS Aggregator</h1>
  <div id="content" class="loading">Loading feeds...</div>

  <script>
    const TOPICS = ['ion trap', 'trapped-ion', 'quantum networks', 'cavity QED'];

    async function loadAllTopics() {
      const contentEl = document.getElementById('content');
      contentEl.innerHTML = '';

      for (const topic of TOPICS) {
        try {
          const r = await fetch(`/api/search?topic=${encodeURIComponent(topic)}`);
          if (!r.ok) throw new Error(await r.text());
          const data = await r.json();
          
          const section = document.createElement('div');
          section.className = 'topic-section';
          
          const titleEl = document.createElement('h2');
          titleEl.className = 'topic-title';
          titleEl.textContent = data.topic || topic;
          section.appendChild(titleEl);
          
          const countEl = document.createElement('div');
          countEl.className = 'count';
          countEl.textContent = `${data.count || 0} items found`;
          section.appendChild(countEl);
          
          const items = data.items || [];
          if (items.length === 0) {
            const noItems = document.createElement('div');
            noItems.className = 'meta';
            noItems.textContent = 'No items available yet.';
            section.appendChild(noItems);
          } else {
            for (const it of items) {
              const itemDiv = document.createElement('div');
              itemDiv.className = 'item';
              
              const d = new Date((it.published_ts || Date.now()) * 1000);
              
              itemDiv.innerHTML = `
                <div class="item-title"><a href="${it.link}" target="_blank" rel="noopener noreferrer">${escapeHtml(it.title || 'Untitled')}</a></div>
                ${it.authors ? `<div class="meta">Authors: ${escapeHtml(it.authors)}</div>` : ''}
                <div class="source">${escapeHtml(it.source || '')} â€” ${d.toLocaleString()}</div>
                ${it.summary ? `<div class="summary">${escapeHtml((it.summary || '').slice(0, 500))}${(it.summary || '').length > 500 ? '...' : ''}</div>` : ''}
              `;
              
              section.appendChild(itemDiv);
            }
          }
          
          contentEl.appendChild(section);
        } catch (err) {
          const section = document.createElement('div');
          section.className = 'topic-section';
          section.innerHTML = `
            <h2 class="topic-title">${escapeHtml(topic)}</h2>
            <div class="meta">Error loading: ${escapeHtml(err.message)}</div>
          `;
          contentEl.appendChild(section);
        }
      }
    }

    function escapeHtml(s) {
      return (s || '').replace(/[&<>"']/g, (c) => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
      }[c]));
    }

    // Load all topics on page load
    loadAllTopics();
  </script>
</body>
</html>
